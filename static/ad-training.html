<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>广告分隔符训练</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <link rel="stylesheet" href="/assets/css/modern-ui.css">
    <style>
        .training-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .sample-editor {
            margin-bottom: 20px;
        }
        
        .content-area {
            font-family: monospace;
            background: #f5f7fa;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            word-break: break-all;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .highlight-ad {
            background-color: #ffcccc;
            border: 1px solid #ff6666;
        }
        
        .highlight-normal {
            background-color: #ccffcc;
            border: 1px solid #66ff66;
        }
        
        .separator-pattern {
            background: #fff3cd;
            padding: 5px;
            margin: 5px 0;
            border-radius: 3px;
            font-family: monospace;
        }
        
        .pattern-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
        }
        
        .pattern-item .pattern-text {
            flex: 1;
            font-family: monospace;
            padding: 5px 10px;
            background: #f5f7fa;
            border-radius: 3px;
        }
        
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        
        .test-success {
            background: #f0f9ff;
            border: 1px solid #67c23a;
            color: #67c23a;
        }
        
        .test-fail {
            background: #fef0f0;
            border: 1px solid #f56c6c;
            color: #f56c6c;
        }
        
        .preview-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .preview-box {
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            padding: 15px;
        }
        
        .preview-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #303133;
        }
    </style>
</head>
<body>
    <div id="app">
        <el-container>
            <el-header height="60px">
                <div class="header-content">
                    <h1>广告分隔符训练</h1>
                    <el-button @click="backToMain" type="primary">返回主页</el-button>
                </div>
            </el-header>
            
            <el-main>
                <div class="training-container">
                    <!-- 分隔符模式配置 -->
                    <el-card class="sample-editor">
                        <template #header>
                            <div class="card-header">
                                <span>分隔符模式配置</span>
                                <el-button type="primary" size="small" @click="addPattern">
                                    <el-icon><Plus /></el-icon> 添加模式
                                </el-button>
                            </div>
                        </template>
                        
                        <div v-for="(pattern, index) in separatorPatterns" :key="index" class="pattern-item">
                            <el-input
                                v-model="pattern.regex"
                                placeholder="输入正则表达式，如: ━{10,} 或 ={20,}"
                                class="pattern-text"
                                style="flex: 1; margin-right: 10px;"
                            />
                            <el-input
                                v-model="pattern.description"
                                placeholder="描述"
                                style="width: 200px; margin-right: 10px;"
                            />
                            <el-button type="danger" size="small" @click="removePattern(index)">删除</el-button>
                        </div>
                        
                        <el-divider></el-divider>
                        
                        <div style="margin-top: 10px;">
                            <el-button type="success" @click="savePatterns">保存配置</el-button>
                            <el-button @click="loadDefaultPatterns">加载默认</el-button>
                        </div>
                    </el-card>
                    
                    <!-- 测试区域 -->
                    <el-card>
                        <template #header>
                            <span>测试消息</span>
                        </template>
                        
                        <el-input
                            v-model="testMessage"
                            type="textarea"
                            :rows="10"
                            placeholder="粘贴包含广告的完整消息，用于测试分隔符检测..."
                        />
                        
                        <el-button type="primary" @click="testPatterns" style="margin-top: 10px;">
                            测试分隔符检测
                        </el-button>
                        
                        <!-- 测试结果 -->
                        <div v-if="testResult" class="test-result" :class="testResult.found ? 'test-success' : 'test-fail'">
                            <div v-if="testResult.found">
                                <el-alert type="success" :closable="false">
                                    <template #title>
                                        检测到广告分隔符！
                                    </template>
                                    <div>
                                        <p>匹配的模式: {{ testResult.matchedPattern }}</p>
                                        <p>分隔符位置: 第 {{ testResult.position }} 个字符</p>
                                    </div>
                                </el-alert>
                            </div>
                            <div v-else>
                                <el-alert type="warning" :closable="false">
                                    未检测到广告分隔符
                                </el-alert>
                            </div>
                        </div>
                        
                        <!-- 预览区域 -->
                        <div v-if="testResult && testResult.found" class="preview-section">
                            <div class="preview-box">
                                <div class="preview-title">正常内容部分</div>
                                <div class="content-area highlight-normal">{{ testResult.normalContent }}</div>
                            </div>
                            <div class="preview-box">
                                <div class="preview-title">广告内容部分</div>
                                <div class="content-area highlight-ad">{{ testResult.adContent }}</div>
                            </div>
                        </div>
                    </el-card>
                    
                    <!-- 训练样本管理 -->
                    <el-card style="margin-top: 20px;">
                        <template #header>
                            <div class="card-header">
                                <span>训练样本库</span>
                                <el-button type="primary" size="small" @click="showAddSample = true">
                                    添加样本
                                </el-button>
                            </div>
                        </template>
                        
                        <el-table :data="trainingSamples" style="width: 100%">
                            <el-table-column prop="id" label="ID" width="80" />
                            <el-table-column prop="description" label="描述" />
                            <el-table-column label="内容预览" width="300">
                                <template #default="scope">
                                    <el-tooltip :content="scope.row.content" placement="top">
                                        <span>{{ scope.row.content.substring(0, 50) }}...</span>
                                    </el-tooltip>
                                </template>
                            </el-table-column>
                            <el-table-column prop="separator" label="分隔符" width="150" />
                            <el-table-column prop="created_at" label="创建时间" width="180" />
                            <el-table-column label="操作" width="150">
                                <template #default="scope">
                                    <el-button size="small" @click="viewSample(scope.row)">查看</el-button>
                                    <el-button size="small" type="danger" @click="deleteSample(scope.row.id)">删除</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                    
                    <!-- 添加样本对话框 -->
                    <el-dialog v-model="showAddSample" title="添加训练样本" width="800px">
                        <el-form :model="newSample" label-width="100px">
                            <el-form-item label="描述">
                                <el-input v-model="newSample.description" placeholder="样本描述" />
                            </el-form-item>
                            <el-form-item label="完整消息">
                                <el-input
                                    v-model="newSample.fullContent"
                                    type="textarea"
                                    :rows="8"
                                    placeholder="粘贴包含正常内容和广告的完整消息"
                                />
                            </el-form-item>
                            <el-form-item label="分隔符">
                                <el-input v-model="newSample.separator" placeholder="输入实际的分隔符，如: ━━━━━━━━━━" />
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="addSample">添加</el-button>
                                <el-button @click="showAddSample = false">取消</el-button>
                            </el-form-item>
                        </el-form>
                    </el-dialog>
                    
                    <!-- 查看样本对话框 -->
                    <el-dialog v-model="showViewSample" title="查看训练样本" width="900px">
                        <div v-if="currentSample">
                            <h4>完整内容：</h4>
                            <div class="content-area" style="margin-bottom: 20px;">{{ currentSample.content }}</div>
                            
                            <el-divider></el-divider>
                            
                            <div class="preview-section">
                                <div>
                                    <h4>正常内容：</h4>
                                    <div class="content-area highlight-normal">{{ currentSample.normalPart }}</div>
                                </div>
                                <div>
                                    <h4>广告内容：</h4>
                                    <div class="content-area highlight-ad">{{ currentSample.adPart }}</div>
                                </div>
                            </div>
                        </div>
                    </el-dialog>
                </div>
            </el-main>
        </el-container>
    </div>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="/assets/js/modules/ad-training.js"></script>
</body>
</html>
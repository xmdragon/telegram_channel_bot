<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á≥ªÁªüÈÖçÁΩÆ - TelegramÊ∂àÊÅØÂÆ°Ê†∏Á≥ªÁªü</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öôÔ∏è</text></svg>">
    
    <!-- Â§ñÈÉ®Ê†∑ÂºèÊñá‰ª∂ -->
    <link rel="stylesheet" href="assets/css/element-plus.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/starcraft.css">
    <link rel="stylesheet" href="assets/css/components/config.css">
    
    <!-- Â§ñÈÉ®ËÑöÊú¨Êñá‰ª∂ -->
    <script src="assets/js/vue.prod.js"></script>
    <script src="assets/js/element-plus.js"></script>
    <script src="assets/js/axios.js"></script>
    <script src="assets/js/components/navbar.js"></script>
    <script src="assets/js/message-manager.js?v=1"></script>
    <script src="assets/js/components/config.js"></script>
</head>
<body>
    <div id="app">
        <!-- ÂØºËà™Ê†è -->
        <nav-bar page-title="‚öôÔ∏è Á≥ªÁªüÈÖçÁΩÆ‰∏≠ÂøÉ" page-subtitle="È¢ëÈÅìÁÆ°ÁêÜ ¬∑ ËøáÊª§ËßÑÂàô ¬∑ ËΩ¨ÂèëËÆæÁΩÆ"></nav-bar>

        <div class="container">
            <!-- ÈÖçÁΩÆÊ†áÁ≠æÈ°µ -->
            <el-tabs v-model="activeTab" type="border-card" class="config-tabs">
                <!-- È¢ëÈÅìÁÆ°ÁêÜ -->
                <el-tab-pane label="üì° È¢ëÈÅìÁÆ°ÁêÜ" name="channels">
                    <div class="config-section">
                        <div class="add-channel-form">
                            <el-tabs v-model="addChannelTab" type="card">
                                <!-- Âçï‰∏™Ê∑ªÂä† -->
                                <el-tab-pane label="Âçï‰∏™Ê∑ªÂä†" name="single">
                                    <el-form :model="newChannel" label-width="100px">
                                        <el-form-item label="È¢ëÈÅìÂêçÁß∞">
                                            <el-input v-model="newChannel.name" placeholder="ËæìÂÖ•È¢ëÈÅìÂêçÁß∞ÔºàÂ¶ÇÔºö@channelnameÔºâ"></el-input>
                                        </el-form-item>
                                        <el-form-item label="È¢ëÈÅìÊ†áÈ¢ò">
                                            <el-input v-model="newChannel.title" placeholder="ËæìÂÖ•È¢ëÈÅìÊ†áÈ¢òÔºàÂèØÈÄâÔºâ"></el-input>
                                        </el-form-item>
                                        <el-form-item>
                                            <el-button type="primary" @click="addChannel" icon="Plus">Ê∑ªÂä†È¢ëÈÅì</el-button>
                                        </el-form-item>
                                    </el-form>
                                </el-tab-pane>
                                
                                <!-- ÊâπÈáèÊ∑ªÂä† -->
                                <el-tab-pane label="ÊâπÈáèÊ∑ªÂä†" name="batch">
                                    <el-form :model="batchChannel" label-width="100px">
                                        <el-form-item label="È¢ëÈÅìÂàóË°®">
                                            <el-input
                                                v-model="batchChannel.channels"
                                                type="textarea"
                                                :rows="6"
                                                placeholder="ÊØèË°åËæìÂÖ•‰∏Ä‰∏™È¢ëÈÅìÂêçÁß∞ÔºåÊîØÊåÅ‰ª•‰∏ãÊ†ºÂºèÔºö&#10;@channelname&#10;https://t.me/channelname&#10;channelname">
                                            </el-input>
                                        </el-form-item>
                                        <el-form-item>
                                            <el-button type="primary" @click="batchAddChannels" :loading="batchChannel.loading" icon="Upload">
                                                ÊâπÈáèÊ∑ªÂä†
                                            </el-button>
                                            <el-button @click="batchChannel.channels = ''" icon="Delete">Ê∏ÖÁ©∫</el-button>
                                        </el-form-item>
                                    </el-form>
                                    
                                    <!-- ÊâπÈáèÊ∑ªÂä†ÁªìÊûú -->
                                    <div v-if="batchChannel.results" style="margin-top: 20px;">
                                        <el-alert 
                                            :title="batchChannel.message" 
                                            :type="batchChannel.success ? 'success' : 'warning'"
                                            :closable="false"
                                            show-icon>
                                        </el-alert>
                                        
                                        <!-- Ê∑ªÂä†ÊàêÂäüÁöÑÈ¢ëÈÅì -->
                                        <div v-if="batchChannel.results.added && batchChannel.results.added.length > 0" style="margin-top: 10px;">
                                            <h5>‚úÖ ÊàêÂäüÊ∑ªÂä†ÁöÑÈ¢ëÈÅìÔºö</h5>
                                            <el-tag v-for="channel in batchChannel.results.added" :key="channel.channel_name" style="margin: 2px;">
                                                {{ channel.channel_title }} ({{ channel.channel_name }})
                                            </el-tag>
                                        </div>
                                        
                                        <!-- Â∑≤Â≠òÂú®ÁöÑÈ¢ëÈÅì -->
                                        <div v-if="batchChannel.results.existed && batchChannel.results.existed.length > 0" style="margin-top: 10px;">
                                            <h5>‚ÑπÔ∏è Â∑≤Â≠òÂú®ÁöÑÈ¢ëÈÅìÔºö</h5>
                                            <el-tag v-for="channel in batchChannel.results.existed" :key="channel" type="info" style="margin: 2px;">
                                                {{ channel }}
                                            </el-tag>
                                        </div>
                                        
                                        <!-- Ëá™Âä®ËÆ¢ÈòÖÁöÑÈ¢ëÈÅì -->
                                        <div v-if="batchChannel.results.subscribed && batchChannel.results.subscribed.length > 0" style="margin-top: 10px;">
                                            <h5>üîî Ëá™Âä®ËÆ¢ÈòÖÁöÑÈ¢ëÈÅìÔºö</h5>
                                            <el-tag v-for="channel in batchChannel.results.subscribed" :key="channel" type="success" style="margin: 2px;">
                                                {{ channel }}
                                            </el-tag>
                                        </div>
                                        
                                        <!-- Ê∑ªÂä†Â§±Ë¥•ÁöÑÈ¢ëÈÅì -->
                                        <div v-if="batchChannel.results.failed && batchChannel.results.failed.length > 0" style="margin-top: 10px;">
                                            <h5>‚ùå Ê∑ªÂä†Â§±Ë¥•ÁöÑÈ¢ëÈÅìÔºö</h5>
                                            <div v-for="item in batchChannel.results.failed" :key="item.channel_name" style="margin: 5px 0;">
                                                <el-tag type="danger">{{ item.channel_name }}</el-tag>
                                                <span style="color: #F56C6C; margin-left: 10px;">{{ item.reason }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </el-tab-pane>
                            </el-tabs>
                        </div>

                        <!-- ÊêúÁ¥¢TelegramÈ¢ëÈÅìÔºàÊöÇÊó∂ÈöêËóèÔºâ -->
                        <div class="search-channel-form" style="margin-top: 20px; padding: 15px; border: 1px solid #e4e7ed; border-radius: 4px; display: none;">
                            <h4>ÊêúÁ¥¢TelegramÈ¢ëÈÅì</h4>
                            <el-form :model="searchForm" label-width="100px">
                                <el-form-item label="ÊêúÁ¥¢ÂÖ≥ÈîÆËØç">
                                    <el-input 
                                        v-model="searchForm.query" 
                                        placeholder="ËæìÂÖ•È¢ëÈÅìÂêçÁß∞ÊàñÂÖ≥ÈîÆËØçÊêúÁ¥¢"
                                        clearable
                                        @keyup.enter="searchChannels">
                                        <template #append>
                                            <el-button @click="searchChannels" :loading="searchForm.loading">
                                                <el-icon><Search /></el-icon> ÊêúÁ¥¢
                                            </el-button>
                                        </template>
                                    </el-input>
                                </el-form-item>
                            </el-form>
                            
                            <!-- ÊêúÁ¥¢ÁªìÊûú -->
                            <div v-if="searchForm.results.length > 0" class="search-results" style="margin-top: 15px;">
                                <h5>ÊêúÁ¥¢ÁªìÊûúÔºö</h5>
                                <div v-for="result in searchForm.results" :key="result.id" class="search-result-item" style="padding: 10px; margin: 5px 0; border: 1px solid #e4e7ed; border-radius: 4px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong>{{ result.title }}</strong>
                                            <span style="color: #909399; margin-left: 10px;">@{{ result.username || 'N/A' }}</span>
                                            <el-tag size="small" style="margin-left: 10px;">{{ result.participants_count || 'N/A' }} ÊàêÂëò</el-tag>
                                        </div>
                                        <el-button 
                                            size="small" 
                                            type="primary"
                                            @click="addSearchedChannel(result)">
                                            Ê∑ªÂä†ÁõëÂê¨
                                        </el-button>
                                    </div>
                                    <div v-if="result.description" style="color: #606266; margin-top: 5px; font-size: 13px;">
                                        {{ result.description }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Êó†ÁªìÊûúÊèêÁ§∫ -->
                            <div v-else-if="searchForm.searched && searchForm.results.length === 0" style="margin-top: 15px; text-align: center; color: #909399;">
                                Ê≤°ÊúâÊâæÂà∞Áõ∏ÂÖ≥È¢ëÈÅì
                            </div>
                        </div>

                        <h3>ÁõëÂê¨È¢ëÈÅìÂàóË°®</h3>
                        
                        <!-- È¢ëÈÅìÊêúÁ¥¢ËøáÊª§ -->
                        <div style="margin-bottom: 20px;">
                            <el-input 
                                v-model="channelSearchFilter" 
                                placeholder="ÊêúÁ¥¢È¢ëÈÅìÂêçÁß∞ÊàñÊ†áÈ¢ò..."
                                clearable
                                prefix-icon="Search"
                                style="width: 300px;">
                            </el-input>
                            <span style="margin-left: 10px; color: #909399;">
                                ÂÖ± {{ filteredChannels.length }} / {{ channels.length }} ‰∏™È¢ëÈÅì
                            </span>
                        </div>
                        
                        <div class="channel-list">
                            <div v-for="channel in filteredChannels" :key="channel.id" class="channel-item">
                                <div class="channel-info">
                                    <span class="channel-name">
                                        {{ channel.name && channel.name.startsWith('@') ? channel.name : '@' + (channel.name || '') }}
                                    </span>
                                    <span v-if="!channel.channel_id" class="channel-id no-id">(Êó†ID)</span>
                                    <span v-else class="channel-id has-id">(ID: {{ channel.channel_id }})</span>
                                    <span class="channel-title">{{ channel.title || 'Êú™ËÆæÁΩÆÊ†áÈ¢ò' }}</span>
                                </div>
                                <div class="channel-actions">
                                    <el-tag 
                                        :type="channel.status === 'active' ? 'success' : 'danger'" 
                                        size="small"
                                        style="cursor: pointer;"
                                        @click="toggleChannelStatus(channel)">
                                        {{ channel.status === 'active' ? 'Ê¥ªË∑É' : 'ÂÅúÁî®' }}
                                    </el-tag>
                                    <el-button 
                                        v-if="!channel.channel_id" 
                                        size="small" 
                                        type="primary" 
                                        @click="resolveChannelId(channel.name)">
                                        Ëß£ÊûêID
                                    </el-button>
                                    <el-button size="small" type="danger" @click="removeChannel(channel.name)">
                                        Âà†Èô§
                                    </el-button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="channel-actions-toolbar">
                            <el-button type="primary" @click="resolveChannelIds" icon="Refresh">
                                ÊâπÈáèËß£ÊûêÈ¢ëÈÅìID
                            </el-button>
                        </div>
                    </div>
                </el-tab-pane>

                <!-- ËøáÊª§ËßÑÂàô -->
                <el-tab-pane label="üõ°Ô∏è ËøáÊª§ËßÑÂàô" name="filters">
                    <div class="config-section">
                        <h3>ÂÜÖÂÆπËøáÊª§ËßÑÂàô</h3>
                        <div class="filter-rules">
                            <div v-for="rule in filterRules" :key="rule.id" class="rule-item">
                                <div class="rule-info">
                                    <strong>{{ rule.name }}</strong>
                                    <span class="rule-pattern">{{ rule.pattern }}</span>
                                </div>
                                <div class="rule-actions">
                                    <el-tag :type="rule.action === 'block' ? 'danger' : 'warning'" size="small">
                                        {{ rule.action === 'block' ? 'ÈòªÊ≠¢' : 'Ê†áËÆ∞' }}
                                    </el-tag>
                                    <el-button size="small" type="danger" @click="removeRule(rule.id)">
                                        Âà†Èô§
                                    </el-button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="add-rule-form">
                            <h4>Ê∑ªÂä†Êñ∞ËßÑÂàô</h4>
                            <el-form :model="newRule" label-width="100px">
                                <el-form-item label="ËßÑÂàôÂêçÁß∞">
                                    <el-input v-model="newRule.name" placeholder="ËæìÂÖ•ËßÑÂàôÂêçÁß∞"></el-input>
                                </el-form-item>
                                <el-form-item label="ÂåπÈÖçÊ®°Âºè">
                                    <el-input v-model="newRule.pattern" placeholder="ËæìÂÖ•Ê≠£ÂàôË°®ËææÂºèÊ®°Âºè"></el-input>
                                </el-form-item>
                                <el-form-item label="ÊâßË°åÂä®‰Ωú">
                                    <el-select v-model="newRule.action" placeholder="ÈÄâÊã©Âä®‰Ωú">
                                        <el-option label="ÈòªÊ≠¢Ê∂àÊÅØ" value="block"></el-option>
                                        <el-option label="Ê†áËÆ∞‰∏∫ÂπøÂëä" value="mark_ad"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="addRule">Ê∑ªÂä†ËßÑÂàô</el-button>
                                </el-form-item>
                            </el-form>
                        </div>
                    </div>
                </el-tab-pane>

                <!-- ËΩ¨ÂèëËÆæÁΩÆ -->
                <el-tab-pane label="üì§ ËΩ¨ÂèëËÆæÁΩÆ" name="forwarding">
                    <div class="config-section">
                        <h3>Ëá™Âä®ËΩ¨ÂèëÈÖçÁΩÆ</h3>
                        <el-form :model="forwardingConfig" label-width="150px">
                            <el-form-item label="ÂêØÁî®Ëá™Âä®ËΩ¨Âèë">
                                <el-switch v-model="forwardingConfig.enabled"></el-switch>
                            </el-form-item>
                            <el-form-item label="ÁõÆÊ†áÈ¢ëÈÅì">
                                <el-input v-model="forwardingConfig.target_channel" placeholder="ËæìÂÖ•ÁõÆÊ†áÈ¢ëÈÅìÂêçÁß∞ÔºàÊîØÊåÅÂ∏¶@Êàñ‰∏çÂ∏¶@Ôºâ" @blur="updateTargetChannelId"></el-input>
                            </el-form-item>
                            <el-form-item label="Ëß£ÊûêÁöÑÈ¢ëÈÅìID" v-if="forwardingConfig.resolved_target_channel_id">
                                <el-input :value="forwardingConfig.resolved_target_channel_id" readonly>
                                    <template #prepend>
                                        <el-icon><InfoFilled /></el-icon>
                                    </template>
                                </el-input>
                            </el-form-item>
                            <el-form-item label="ÂÆ°Ê†∏Áæ§">
                                <el-input v-model="forwardingConfig.review_group" placeholder="ËæìÂÖ•ÂÆ°Ê†∏Áæ§ÈìæÊé•„ÄÅIDÊàñÁî®Êà∑Âêç" @blur="updateReviewGroupId">
                                    <template #prepend>
                                        <el-button @click="showReviewGroupHelp">üí°</el-button>
                                    </template>
                                </el-input>
                                <div class="form-hint">
                                    <small>ÊîØÊåÅÁæ§ÈìæÊé•ÔºàÂ¶ÇÔºöhttps://t.me/+xxxÔºâ„ÄÅÁæ§IDÔºàÂ¶ÇÔºö-1001234567890ÔºâÊàñÁæ§Áî®Êà∑ÂêçÔºàÂ¶ÇÔºö@review_groupÔºâ„ÄÇ</small>
                                </div>
                            </el-form-item>
                            <el-form-item label="Ëß£ÊûêÁöÑÁæ§ID" v-if="forwardingConfig.resolved_group_id">
                                <el-input :value="forwardingConfig.resolved_group_id" readonly>
                                    <template #prepend>
                                        <el-icon><InfoFilled /></el-icon>
                                    </template>
                                </el-input>
                            </el-form-item>
                            <el-form-item label="ËΩ¨ÂèëÂª∂ËøüÔºàÁßíÔºâ">
                                <el-input-number v-model="forwardingConfig.delay" :min="0" :max="3600"></el-input-number>
                                <div class="form-hint">
                                    <small>Ê∂àÊÅØÂú®ÂÆ°Ê†∏Áæ§‰∏≠ÂÅúÁïôÂ§öÈïøÊó∂Èó¥ÂêéËá™Âä®ËΩ¨ÂèëÔºà0Ë°®Á§∫‰∏çËá™Âä®ËΩ¨ÂèëÔºâ</small>
                                </div>
                            </el-form-item>
                            <el-form-item label="ËΩ¨ÂèëÊù°‰ª∂">
                                <el-checkbox-group v-model="forwardingConfig.conditions">
                                    <el-checkbox label="approved">Â∑≤ÊâπÂáÜÊ∂àÊÅØ</el-checkbox>
                                    <el-checkbox label="auto_approved">Ëá™Âä®ÊâπÂáÜÊ∂àÊÅØ</el-checkbox>
                                </el-checkbox-group>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="saveForwardingConfig">‰øùÂ≠òÈÖçÁΩÆ</el-button>
                            </el-form-item>
                        </el-form>
                    </div>
                </el-tab-pane>

                <!-- Á≥ªÁªüËÆæÁΩÆ -->
                <el-tab-pane label="üîß Á≥ªÁªüËÆæÁΩÆ" name="system">
                    <div class="config-section">
                        <h3>Á≥ªÁªüÂèÇÊï∞ÈÖçÁΩÆ</h3>
                        <el-form :model="systemConfig" label-width="150px">
                            <el-form-item label="ÂÆ°Ê†∏Ê®°Âºè">
                                <el-radio-group v-model="systemConfig.review_mode">
                                    <el-radio label="manual">ÊâãÂä®ÂÆ°Ê†∏</el-radio>
                                    <el-radio label="auto">Ëá™Âä®ÂÆ°Ê†∏</el-radio>
                                    <el-radio label="hybrid">Ê∑∑ÂêàÊ®°Âºè</el-radio>
                                </el-radio-group>
                            </el-form-item>
                            <el-form-item label="Ê∂àÊÅØ‰øùÁïôÂ§©Êï∞">
                                <el-input-number v-model="systemConfig.retention_days" :min="1" :max="365"></el-input-number>
                            </el-form-item>
                            <el-form-item label="ÊúÄÂ§ßÂπ∂ÂèëÊï∞">
                                <el-input-number v-model="systemConfig.max_concurrent" :min="1" :max="100"></el-input-number>
                            </el-form-item>
                            <el-form-item label="Êó•ÂøóÁ∫ßÂà´">
                                <el-select v-model="systemConfig.log_level">
                                    <el-option label="DEBUG" value="debug"></el-option>
                                    <el-option label="INFO" value="info"></el-option>
                                    <el-option label="WARNING" value="warning"></el-option>
                                    <el-option label="ERROR" value="error"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="ÂéÜÂè≤Ê∂àÊÅØÈááÈõÜÊï∞">
                                <el-input-number v-model="systemConfig.history_message_limit" :min="1" :max="1000" placeholder="50"></el-input-number>
                                <div style="font-size: 12px; color: #999; margin-top: 5px;">
                                    È¶ñÊ¨°ÈááÈõÜÊàñÈáçÂêØÂêé‰ªéÈ¢ëÈÅìËé∑ÂèñÁöÑÂéÜÂè≤Ê∂àÊÅØÊù°Êï∞
                                </div>
                            </el-form-item>
                            <el-form-item label="È¢ëÈÅìËêΩÊ¨æ">
                                <el-input 
                                    type="textarea" 
                                    v-model="systemConfig.channel_signature" 
                                    placeholder="ËæìÂÖ•È¢ëÈÅìËêΩÊ¨æÂÜÖÂÆπÔºåÊîØÊåÅÂ§öË°åÔºàÁî®ÂõûËΩ¶Êç¢Ë°åÔºâ"
                                    :rows="4">
                                </el-input>
                                <div style="font-size: 12px; color: #999; margin-top: 5px;">
                                    Ê∂àÊÅØÁªèËøáÊô∫ËÉΩÂéªÈô§Â∞æÈÉ®ÂÜÖÂÆπÂêéÔºå‰ºöËá™Âä®Ê∑ªÂä†Ê≠§ËêΩÊ¨æÂà∞Ê∂àÊÅØÂ∞æÈÉ®
                                </div>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="saveSystemConfig">‰øùÂ≠òÈÖçÁΩÆ</el-button>
                                <el-button @click="resetSystemConfig">ÈáçÁΩÆÈªòËÆ§</el-button>
                            </el-form-item>
                        </el-form>
                    </div>
                </el-tab-pane>
            </el-tabs>
        </div>
        
        <!-- Áä∂ÊÄÅÊ∂àÊÅØ -->
        <div v-if="statusMessage" class="status-message" :class="statusType">
            {{ statusMessage }}
        </div>
        
        <!-- Âä†ËΩΩÈÅÆÁΩ© -->
        <div v-if="loading" class="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>{{ loadingMessage }}</p>
            </div>
        </div>
    </div>
</body>
</html> 
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿç®¡ç†</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="assets/css/element-plus.css">
    <link rel="stylesheet" href="assets/css/element-plus-fixes.css">
    <link rel="stylesheet" href="assets/css/modern-ui.css">
    <script src="assets/js/vue.prod.js"></script>
    <script src="assets/js/element-plus.js"></script>
    <script src="assets/js/axios.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/components/navbar.js"></script>
</head>
<body>
    <div id="app">
        <!-- å¯¼èˆªæ  -->
        <nav-bar page-title="âš™ï¸ ç³»ç»Ÿç®¡ç†æ§åˆ¶å°" page-subtitle="é…ç½®ç®¡ç† Â· ç³»ç»Ÿç›‘æ§ Â· è§„åˆ™è®¾ç½®"></nav-bar>

        <div class="container">
            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ” ç³»ç»ŸçŠ¶æ€</h2>
                </div>
                <div class="card-content">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number">{{ health.status === 'healthy' ? 'âœ…' : 'âŒ' }}</div>
                            <div class="stat-label">ç³»ç»ŸçŠ¶æ€</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ health.database === 'connected' ? 'âœ…' : 'âŒ' }}</div>
                            <div class="stat-label">æ•°æ®åº“</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ health.version || 'N/A' }}</div>
                            <div class="stat-label">ç‰ˆæœ¬</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <el-button @click="checkHealth" type="primary" icon="Refresh">
                            åˆ·æ–°çŠ¶æ€
                        </el-button>
                    </div>
                </div>
            </div>

            <!-- é¢‘é“ç®¡ç† -->
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ“º é¢‘é“ç®¡ç†</h2>
                </div>
                <div class="card-content">
                    <div style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center;">
                        <el-input
                            v-model="channelSearchKeyword"
                            placeholder="æœç´¢é¢‘é“ï¼ˆåç§°ç²¾å‡†åŒ¹é…æˆ–æ ‡é¢˜æ¨¡ç³ŠåŒ¹é…ï¼‰"
                            clearable
                            @input="searchChannels"
                            style="max-width: 400px;">
                            <template #prefix>
                                <el-icon><Search /></el-icon>
                            </template>
                        </el-input>
                        <el-button @click="showAddChannelDialog = true" type="primary" icon="Plus">
                            æ·»åŠ é¢‘é“
                        </el-button>
                    </div>
                    
                    <div class="list-item" v-for="channel in channels" :key="channel.id">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div class="list-item-title">{{ channel.channel_name }}</div>
                                <div class="list-item-subtitle">{{ channel.channel_id }}</div>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <el-tag :type="getChannelTypeColor(channel.channel_type)">
                                    {{ getChannelTypeText(channel.channel_type) }}
                                </el-tag>
                                <el-tag :type="channel.is_active ? 'success' : 'danger'">
                                    {{ channel.is_active ? 'å¯ç”¨' : 'ç¦ç”¨' }}
                                </el-tag>
                                <el-button @click="editChannel(channel)" type="info" size="small">
                                    ç¼–è¾‘
                                </el-button>
                                <el-button @click="deleteChannel(channel.id)" type="danger" size="small">
                                    åˆ é™¤
                                </el-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¿‡æ»¤è§„åˆ™ç®¡ç† -->
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ” è¿‡æ»¤è§„åˆ™</h2>
                </div>
                <div class="card-content">
                    <div style="margin-bottom: 20px;">
                        <el-button @click="showAddRuleDialog = true" type="primary" icon="Plus">
                            æ·»åŠ è§„åˆ™
                        </el-button>
                    </div>
                    
                    <div class="list-item" v-for="rule in filterRules" :key="rule.id">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div class="list-item-title">{{ rule.pattern }}</div>
                                <div class="list-item-subtitle">{{ rule.description }}</div>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <el-tag :type="rule.rule_type === 'keyword' ? 'primary' : 'warning'">
                                    {{ rule.rule_type }}
                                </el-tag>
                                <el-tag :type="rule.is_active ? 'success' : 'danger'">
                                    {{ rule.is_active ? 'å¯ç”¨' : 'ç¦ç”¨' }}
                                </el-tag>
                                <el-button @click="editRule(rule)" type="info" size="small">
                                    ç¼–è¾‘
                                </el-button>
                                <el-button @click="deleteRule(rule.id)" type="danger" size="small">
                                    åˆ é™¤
                                </el-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è®­ç»ƒæ•°æ®ç®¡ç† -->
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ¯ è®­ç»ƒæ•°æ®ç®¡ç†</h2>
                </div>
                <div class="card-content">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <div style="flex: 1;">
                            <p style="margin: 0 0 10px 0; color: #666;">ç®¡ç†å¹¿å‘Šæ£€æµ‹è®­ç»ƒæ•°æ®ï¼ŒåŒ…æ‹¬æŸ¥çœ‹ã€åˆ é™¤è¯¯åˆ¤æ•°æ®ã€å»é‡å’Œä¼˜åŒ–å­˜å‚¨ã€‚</p>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <el-tag type="info">æ ·æœ¬æ•°: {{ trainingStats.totalSamples || 0 }}</el-tag>
                                <el-tag type="warning">å­˜å‚¨: {{ formatSize(trainingStats.storageSize || 0) }}</el-tag>
                            </div>
                        </div>
                        <el-button @click="openTrainingManager" type="primary" icon="Setting">
                            æ‰“å¼€ç®¡ç†ç•Œé¢
                        </el-button>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿæ“ä½œ -->
            <div class="card">
                <div class="card-header">
                    <h2>âš¡ ç³»ç»Ÿæ“ä½œ</h2>
                </div>
                <div class="card-content">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <el-button @click="restartSystem" type="warning" icon="Refresh">
                            é‡å¯ç³»ç»Ÿ
                        </el-button>
                        <el-button @click="backupData" type="info" icon="Download">
                            å¤‡ä»½æ•°æ®
                        </el-button>
                        <el-button @click="clearCache" type="danger" icon="Delete">
                            æ¸…ç†ç¼“å­˜
                        </el-button>
                        <el-button @click="exportLogs" type="primary" icon="Document">
                            å¯¼å‡ºæ—¥å¿—
                        </el-button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- çŠ¶æ€æ¶ˆæ¯ -->
        <div v-if="statusMessage" class="status-message" :class="statusType">
            {{ statusMessage }}
        </div>
        
        <!-- åŠ è½½é®ç½© -->
        <div v-if="loading" class="loading-overlay">
            <div class="loading-content">
                <el-icon class="is-loading">
                    <Loading />
                </el-icon>
                <p style="margin-top: 15px; color: #00ff41;">{{ loadingMessage }}</p>
            </div>
        </div>
    </div>

    <script src="./assets/js/components/admin.js"></script>
</body>
</html>
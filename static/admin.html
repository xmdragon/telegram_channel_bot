<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统管理</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="assets/css/element-plus.css">
    <link rel="stylesheet" href="assets/css/element-plus-fixes.css">
    <link rel="stylesheet" href="assets/css/modern-ui.css">
    <script src="assets/js/vue.prod.js"></script>
    <script src="assets/js/element-plus.js"></script>
    <script src="assets/js/axios.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/components/navbar.js"></script>
</head>
<body>
    <div id="app">
        <!-- 导航栏 -->
        <nav-bar page-title="⚙️ 系统管理控制台" page-subtitle="配置管理 · 系统监控 · 规则设置"></nav-bar>

        <div class="container">
            <!-- 系统状态 -->
            <div class="card">
                <div class="card-header">
                    <h2>🔍 系统状态</h2>
                </div>
                <div class="card-content">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number">{{ health.status === 'healthy' ? '✅' : '❌' }}</div>
                            <div class="stat-label">系统状态</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ health.database === 'connected' ? '✅' : '❌' }}</div>
                            <div class="stat-label">数据库</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ health.version || 'N/A' }}</div>
                            <div class="stat-label">版本</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <el-button @click="checkHealth" type="primary" icon="Refresh">
                            刷新状态
                        </el-button>
                    </div>
                </div>
            </div>

            <!-- 频道管理 -->
            <div class="card">
                <div class="card-header">
                    <h2>📺 频道管理</h2>
                </div>
                <div class="card-content">
                    <div style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center;">
                        <el-input
                            v-model="channelSearchKeyword"
                            placeholder="搜索频道（名称精准匹配或标题模糊匹配）"
                            clearable
                            @input="searchChannels"
                            style="max-width: 400px;">
                            <template #prefix>
                                <el-icon><Search /></el-icon>
                            </template>
                        </el-input>
                        <el-button @click="showAddChannelDialog = true" type="primary" icon="Plus">
                            添加频道
                        </el-button>
                    </div>
                    
                    <div class="list-item" v-for="channel in channels" :key="channel.id">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div class="list-item-title">{{ channel.channel_name }}</div>
                                <div class="list-item-subtitle">{{ channel.channel_id }}</div>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <el-tag :type="getChannelTypeColor(channel.channel_type)">
                                    {{ getChannelTypeText(channel.channel_type) }}
                                </el-tag>
                                <el-tag :type="channel.is_active ? 'success' : 'danger'">
                                    {{ channel.is_active ? '启用' : '禁用' }}
                                </el-tag>
                                <el-button @click="editChannel(channel)" type="info" size="small">
                                    编辑
                                </el-button>
                                <el-button @click="deleteChannel(channel.id)" type="danger" size="small">
                                    删除
                                </el-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 过滤规则管理 -->
            <div class="card">
                <div class="card-header">
                    <h2>🔍 过滤规则</h2>
                </div>
                <div class="card-content">
                    <div style="margin-bottom: 20px;">
                        <el-button @click="showAddRuleDialog = true" type="primary" icon="Plus">
                            添加规则
                        </el-button>
                    </div>
                    
                    <div class="list-item" v-for="rule in filterRules" :key="rule.id">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div class="list-item-title">{{ rule.pattern }}</div>
                                <div class="list-item-subtitle">{{ rule.description }}</div>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <el-tag :type="rule.rule_type === 'keyword' ? 'primary' : 'warning'">
                                    {{ rule.rule_type }}
                                </el-tag>
                                <el-tag :type="rule.is_active ? 'success' : 'danger'">
                                    {{ rule.is_active ? '启用' : '禁用' }}
                                </el-tag>
                                <el-button @click="editRule(rule)" type="info" size="small">
                                    编辑
                                </el-button>
                                <el-button @click="deleteRule(rule.id)" type="danger" size="small">
                                    删除
                                </el-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 训练数据管理 -->
            <div class="card">
                <div class="card-header">
                    <h2>🎯 训练数据管理</h2>
                </div>
                <div class="card-content">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <div style="flex: 1;">
                            <p style="margin: 0 0 10px 0; color: #666;">管理广告检测训练数据，包括查看、删除误判数据、去重和优化存储。</p>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <el-tag type="info">样本数: {{ trainingStats.totalSamples || 0 }}</el-tag>
                                <el-tag type="warning">存储: {{ formatSize(trainingStats.storageSize || 0) }}</el-tag>
                            </div>
                        </div>
                        <el-button @click="openTrainingManager" type="primary" icon="Setting">
                            打开管理界面
                        </el-button>
                    </div>
                </div>
            </div>

            <!-- 系统操作 -->
            <div class="card">
                <div class="card-header">
                    <h2>⚡ 系统操作</h2>
                </div>
                <div class="card-content">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <el-button @click="restartSystem" type="warning" icon="Refresh">
                            重启系统
                        </el-button>
                        <el-button @click="backupData" type="info" icon="Download">
                            备份数据
                        </el-button>
                        <el-button @click="clearCache" type="danger" icon="Delete">
                            清理缓存
                        </el-button>
                        <el-button @click="exportLogs" type="primary" icon="Document">
                            导出日志
                        </el-button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 状态消息 -->
        <div v-if="statusMessage" class="status-message" :class="statusType">
            {{ statusMessage }}
        </div>
        
        <!-- 加载遮罩 -->
        <div v-if="loading" class="loading-overlay">
            <div class="loading-content">
                <el-icon class="is-loading">
                    <Loading />
                </el-icon>
                <p style="margin-top: 15px; color: #00ff41;">{{ loadingMessage }}</p>
            </div>
        </div>
    </div>

    <script src="./assets/js/components/admin.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试主页</title>
</head>
<body>
    <div id="app">
        <h1>消息管理系统</h1>
        <p>待审核消息数: {{ stats.pending }}</p>
        <button @click="loadMessages">刷新消息</button>
        
        <div v-if="loading">加载中...</div>
        
        <div v-for="msg in messages" :key="msg.id">
            <div style="border: 1px solid #ccc; padding: 10px; margin: 10px;">
                <p>ID: {{ msg.id }}</p>
                <p>{{ msg.content }}</p>
            </div>
        </div>
    </div>
    
    <script src="assets/js/vue.prod.js"></script>
    <script src="assets/js/axios.js"></script>
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    messages: [],
                    stats: { pending: 0, approved: 0, rejected: 0 },
                    loading: false
                }
            },
            methods: {
                async loadMessages() {
                    this.loading = true;
                    try {
                        // 获取认证token
                        const token = localStorage.getItem('admin_token');
                        
                        const response = await axios.get('/api/messages/', {
                            params: { status: 'pending', page: 1, size: 20 },
                            headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                        });
                        
                        this.messages = response.data.items || [];
                        console.log('加载了', this.messages.length, '条消息');
                    } catch (error) {
                        console.error('加载失败:', error);
                        if (error.response?.status === 401) {
                            alert('请先登录');
                            window.location.href = '/static/auth.html';
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                
                async loadStats() {
                    try {
                        const token = localStorage.getItem('admin_token');
                        const response = await axios.get('/api/messages/stats', {
                            headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                        });
                        this.stats = response.data;
                    } catch (error) {
                        console.error('加载统计失败:', error);
                    }
                }
            },
            mounted() {
                console.log('Vue应用已挂载');
                this.loadStats();
                this.loadMessages();
            }
        }).mount('#app');
    </script>
</body>
</html>
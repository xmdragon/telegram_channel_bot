<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram ç™»å½• - æ˜Ÿé™…äº‰éœ¸é£æ ¼</title>
    <link rel="stylesheet" href="assets/css/element-plus.css">
    <link rel="stylesheet" href="assets/css/starcraft.css">
    <script src="assets/js/vue.js"></script>
    <script src="assets/js/element-plus.js"></script>
    <script src="assets/js/axios.js"></script>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>ğŸ” Telegram è®¤è¯ç³»ç»Ÿ</h1>
            <p>å®‰å…¨ç™»å½• Â· èº«ä»½éªŒè¯ Â· ç³»ç»Ÿæ¥å…¥</p>
        </div>

        <!-- å¯¼èˆªæ  -->
        <div class="nav-bar">
            <div class="nav-links">
                <a href="/" class="nav-link">ğŸ  ä¸»æ§åˆ¶å°</a>
                <a href="/config" class="nav-link">âš™ï¸ ç³»ç»Ÿé…ç½®</a>
                <a href="/status" class="nav-link">ğŸ“Š ç³»ç»ŸçŠ¶æ€</a>
                <a href="/auth" class="nav-link active">ğŸ” Telegramç™»å½•</a>
            </div>
            <div class="nav-links">
                <span style="color: #7fdbff; font-weight: 700;">è®¤è¯çŠ¶æ€: {{ authStatus }}</span>
            </div>
        </div>

        <div class="container">
            <div class="form-container">
                <div class="form-title">Telegram è®¤è¯</div>
                
                <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
                <div class="step-indicator">
                    <div class="step" :class="{ active: currentStep >= 1, completed: currentStep > 1 }">1</div>
                    <div class="step-line"></div>
                    <div class="step" :class="{ active: currentStep >= 2, completed: currentStep > 2 }">2</div>
                    <div class="step-line"></div>
                    <div class="step" :class="{ active: currentStep >= 3, completed: currentStep > 3 }">3</div>
                </div>

                <!-- æ­¥éª¤1: é…ç½®ä¿¡æ¯ -->
                <div class="form-step" :class="{ active: currentStep === 1 }">
                    <div class="form-group">
                        <label class="form-label">API ID</label>
                        <el-input 
                            v-model="config.api_id" 
                            placeholder="è¯·è¾“å…¥ Telegram API ID"
                            type="text">
                        </el-input>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">API Hash</label>
                        <el-input 
                            v-model="config.api_hash" 
                            placeholder="è¯·è¾“å…¥ Telegram API Hash"
                            type="password">
                        </el-input>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">æ‰‹æœºå·ç </label>
                        <el-input 
                            v-model="config.phone" 
                            placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç  (æ ¼å¼: +8613800138000)"
                            type="text">
                        </el-input>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <el-button @click="nextStep" type="primary" :disabled="!canProceed">
                            ä¸‹ä¸€æ­¥
                        </el-button>
                    </div>
                </div>

                <!-- æ­¥éª¤2: éªŒè¯ç  -->
                <div class="form-step" :class="{ active: currentStep === 2 }">
                    <div class="form-group">
                        <label class="form-label">éªŒè¯ç </label>
                        <el-input 
                            v-model="verificationCode" 
                            placeholder="è¯·è¾“å…¥æ”¶åˆ°çš„éªŒè¯ç "
                            type="text">
                        </el-input>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">å¯†ç  (å¦‚æœæœ‰)</label>
                        <el-input 
                            v-model="password" 
                            placeholder="è¯·è¾“å…¥ä¸¤æ­¥éªŒè¯å¯†ç  (å¯é€‰)"
                            type="password">
                        </el-input>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <el-button @click="prevStep" type="info">
                            ä¸Šä¸€æ­¥
                        </el-button>
                        <el-button @click="verifyCode" type="primary" :loading="verifying">
                            éªŒè¯
                        </el-button>
                    </div>
                </div>

                <!-- æ­¥éª¤3: å®Œæˆ -->
                <div class="form-step" :class="{ active: currentStep === 3 }">
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="font-size: 4em; color: #00ff41; margin-bottom: 20px;">âœ…</div>
                        <h3 style="color: #00ff41; margin-bottom: 10px;">è®¤è¯æˆåŠŸï¼</h3>
                        <p style="color: #7fdbff;">Telegram å®¢æˆ·ç«¯å·²æˆåŠŸè¿æ¥</p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <el-button @click="goToMain" type="success">
                            è¿›å…¥ç³»ç»Ÿ
                        </el-button>
                        <el-button @click="disconnect" type="warning">
                            æ–­å¼€è¿æ¥
                        </el-button>
                    </div>
                </div>

                <!-- é”™è¯¯ä¿¡æ¯ -->
                <div v-if="errorMessage" style="margin-top: 20px; padding: 15px; background: rgba(255, 71, 87, 0.1); border: 2px solid #ff4757; border-radius: 5px; color: #ff4757;">
                    {{ errorMessage }}
                </div>
            </div>
        </div>
        
        <!-- çŠ¶æ€æ¶ˆæ¯ -->
        <div v-if="statusMessage" class="status-message" :class="statusType">
            {{ statusMessage }}
        </div>
        
        <!-- åŠ è½½é®ç½© -->
        <div v-if="loading" class="loading-overlay">
            <div class="loading-content">
                <el-icon class="is-loading">
                    <Loading />
                </el-icon>
                <p style="margin-top: 15px; color: #00ff41;">{{ loadingMessage }}</p>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage } = ElementPlus;

        createApp({
            data() {
                return {
                    loading: false,
                    loadingMessage: '',
                    statusMessage: '',
                    statusType: 'success',
                    authStatus: 'æœªè®¤è¯',
                    currentStep: 1,
                    verifying: false,
                    errorMessage: '',
                    config: {
                        api_id: '',
                        api_hash: '',
                        phone: ''
                    },
                    verificationCode: '',
                    password: ''
                }
            },
            
            computed: {
                canProceed() {
                    return this.config.api_id && this.config.api_hash && this.config.phone;
                }
            },
            
            mounted() {
                this.checkAuthStatus();
            },
            
            methods: {
                async checkAuthStatus() {
                    try {
                        const response = await axios.get('/api/auth/status');
                        if (response.data.authorized) {
                            this.authStatus = 'å·²è®¤è¯';
                            this.currentStep = 3;
                        } else {
                            this.authStatus = 'æœªè®¤è¯';
                        }
                    } catch (error) {
                        console.error('æ£€æŸ¥è®¤è¯çŠ¶æ€å¤±è´¥:', error);
                    }
                },
                
                nextStep() {
                    if (this.canProceed) {
                        this.currentStep = 2;
                        this.sendCode();
                    }
                },
                
                prevStep() {
                    if (this.currentStep > 1) {
                        this.currentStep--;
                    }
                },
                
                async sendCode() {
                    this.loading = true;
                    this.loadingMessage = 'æ­£åœ¨å‘é€éªŒè¯ç ...';
                    this.errorMessage = '';
                    
                    try {
                        const response = await axios.post('/api/auth/send-code', {
                            api_id: this.config.api_id,
                            api_hash: this.config.api_hash,
                            phone: this.config.phone
                        });
                        
                        if (response.data.success) {
                            this.showSuccess('éªŒè¯ç å·²å‘é€');
                        } else {
                            this.errorMessage = response.data.message || 'å‘é€éªŒè¯ç å¤±è´¥';
                        }
                    } catch (error) {
                        this.errorMessage = 'å‘é€éªŒè¯ç å¤±è´¥: ' + (error.response?.data?.detail || error.message);
                    } finally {
                        this.loading = false;
                    }
                },
                
                async verifyCode() {
                    this.verifying = true;
                    this.errorMessage = '';
                    
                    try {
                        const response = await axios.post('/api/auth/verify-code', {
                            code: this.verificationCode,
                            password: this.password
                        });
                        
                        if (response.data.success) {
                            this.currentStep = 3;
                            this.authStatus = 'å·²è®¤è¯';
                            this.showSuccess('è®¤è¯æˆåŠŸ');
                        } else {
                            this.errorMessage = response.data.message || 'éªŒè¯å¤±è´¥';
                        }
                    } catch (error) {
                        this.errorMessage = 'éªŒè¯å¤±è´¥: ' + (error.response?.data?.detail || error.message);
                    } finally {
                        this.verifying = false;
                    }
                },
                
                goToMain() {
                    window.location.href = '/';
                },
                
                async disconnect() {
                    try {
                        const response = await axios.post('/api/auth/disconnect');
                        if (response.data.success) {
                            this.authStatus = 'æœªè®¤è¯';
                            this.currentStep = 1;
                            this.showSuccess('å·²æ–­å¼€è¿æ¥');
                        } else {
                            this.showError('æ–­å¼€è¿æ¥å¤±è´¥');
                        }
                    } catch (error) {
                        this.showError('æ–­å¼€è¿æ¥å¤±è´¥: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                showSuccess(message) {
                    this.statusMessage = message;
                    this.statusType = 'success';
                    setTimeout(() => {
                        this.statusMessage = '';
                    }, 3000);
                },
                
                showError(message) {
                    this.statusMessage = message;
                    this.statusType = 'error';
                    setTimeout(() => {
                        this.statusMessage = '';
                    }, 5000);
                }
            }
        }).mount('#app');
    </script>

    <style>
        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #00ff41;
            color: #00ff41;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background: #00ff41;
            color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
        }
        
        .step.completed {
            background: #2ed573;
            border-color: #2ed573;
            color: #000;
        }
        
        .step-line {
            width: 60px;
            height: 2px;
            background: rgba(0, 255, 65, 0.3);
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
        }
    </style>
</body>
</html> 
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘¥ ç®¡ç†å‘˜ç®¡ç†</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- å¤–éƒ¨æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="assets/css/element-plus.css">
    <link rel="stylesheet" href="assets/css/element-plus-fixes.css">
    <link rel="stylesheet" href="assets/css/modern-ui.css">
    <link rel="stylesheet" href="assets/css/admin-manage.css">
</head>
<body>
    <div id="app">
        <!-- å¯¼èˆªæ  -->
        <nav-bar page-title="ğŸ‘¥ ç®¡ç†å‘˜ç®¡ç†"></nav-bar>

        <div class="container">
            <!-- å½“å‰ç®¡ç†å‘˜ä¿¡æ¯ -->
            <div class="current-admin-card">
                <div class="card-header">
                    <h3>å½“å‰è´¦å·</h3>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <span class="label">ç”¨æˆ·åï¼š</span>
                        <span class="value">{{ currentAdmin.username }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è§’è‰²ï¼š</span>
                        <span class="value">
                            <el-tag v-if="currentAdmin.is_super_admin" type="danger">è¶…çº§ç®¡ç†å‘˜</el-tag>
                            <el-tag v-else>æ™®é€šç®¡ç†å‘˜</el-tag>
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">æœ€åç™»å½•ï¼š</span>
                        <span class="value">{{ formatDateTime(currentAdmin.last_login) }}</span>
                    </div>
                    <div class="action-buttons">
                        <el-button type="primary" @click="showChangePasswordDialog">ä¿®æ”¹å¯†ç </el-button>
                    </div>
                </div>
            </div>

            <!-- ç®¡ç†å‘˜åˆ—è¡¨ï¼ˆä»…è¶…çº§ç®¡ç†å‘˜å¯è§ï¼‰ -->
            <div v-if="currentAdmin.is_super_admin" class="admin-list-card">
                <div class="card-header">
                    <h3>ç®¡ç†å‘˜åˆ—è¡¨</h3>
                    <el-button type="primary" @click="showCreateAdminDialog">+ æ·»åŠ ç®¡ç†å‘˜</el-button>
                </div>
                <div class="card-body">
                    <el-table :data="admins" style="width: 100%" stripe>
                        <el-table-column prop="username" label="ç”¨æˆ·å" width="150" show-overflow-tooltip></el-table-column>
                        <el-table-column label="è§’è‰²" width="120">
                            <template #default="scope">
                                <el-tag v-if="scope.row.is_super_admin" type="danger">è¶…çº§ç®¡ç†å‘˜</el-tag>
                                <el-tag v-else>æ™®é€šç®¡ç†å‘˜</el-tag>
                            </template>
                        </el-table-column>
                        <el-table-column label="çŠ¶æ€" width="100">
                            <template #default="scope">
                                <el-tag :type="scope.row.is_active ? 'success' : 'info'">
                                    {{ scope.row.is_active ? 'å¯ç”¨' : 'ç¦ç”¨' }}
                                </el-tag>
                            </template>
                        </el-table-column>
                        <el-table-column label="æƒé™" min-width="200">
                            <template #default="scope">
                                <div v-if="scope.row.is_super_admin">
                                    <el-tag type="danger">æ‰€æœ‰æƒé™</el-tag>
                                </div>
                                <div v-else>
                                    <el-tag v-for="perm in scope.row.permissions" :key="perm" 
                                            style="margin: 2px;">
                                        {{ getPermissionLabel(perm) }}
                                    </el-tag>
                                </div>
                            </template>
                        </el-table-column>
                        <el-table-column label="æœ€åç™»å½•" width="180">
                            <template #default="scope">
                                {{ formatDateTime(scope.row.last_login) || 'ä»æœªç™»å½•' }}
                            </template>
                        </el-table-column>
                        <el-table-column label="åˆ›å»ºæ—¶é—´" width="180">
                            <template #default="scope">
                                {{ formatDateTime(scope.row.created_at) }}
                            </template>
                        </el-table-column>
                        <el-table-column label="æ“ä½œ" width="200" fixed="right">
                            <template #default="scope">
                                <el-button v-if="scope.row.id !== currentAdmin.id" 
                                         size="small" 
                                         @click="showEditAdminDialog(scope.row)">
                                    ç¼–è¾‘
                                </el-button>
                                <el-button v-if="scope.row.id !== currentAdmin.id" 
                                         size="small" 
                                         type="danger" 
                                         @click="deleteAdmin(scope.row)">
                                    åˆ é™¤
                                </el-button>
                                <span v-else style="color: #999;">å½“å‰è´¦å·</span>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
            </div>

            <!-- æƒé™è¯´æ˜ -->
            <div v-if="currentAdmin.is_super_admin" class="permissions-info-card">
                <div class="card-header">
                    <h3>æƒé™è¯´æ˜</h3>
                </div>
                <div class="card-body">
                    <div v-for="(perms, module) in availablePermissions" :key="module" class="permission-module">
                        <h4>{{ getModuleLabel(module) }}</h4>
                        <div class="permission-list">
                            <div v-for="perm in perms" :key="perm.name" class="permission-item">
                                <span class="permission-name">{{ perm.name }}</span>
                                <span class="permission-desc">{{ perm.description }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¿®æ”¹å¯†ç å¯¹è¯æ¡† -->
        <el-dialog v-model="changePasswordDialog.visible" title="ä¿®æ”¹å¯†ç " width="400px">
            <el-form :model="changePasswordDialog.form" label-width="100px">
                <el-form-item label="åŸå¯†ç " required>
                    <el-input v-model="changePasswordDialog.form.old_password" 
                            type="password" 
                            placeholder="è¯·è¾“å…¥åŸå¯†ç "
                            show-password />
                </el-form-item>
                <el-form-item label="æ–°å¯†ç " required>
                    <el-input v-model="changePasswordDialog.form.new_password" 
                            type="password" 
                            placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"
                            show-password />
                </el-form-item>
                <el-form-item label="ç¡®è®¤å¯†ç " required>
                    <el-input v-model="changePasswordDialog.form.confirm_password" 
                            type="password" 
                            placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç "
                            show-password />
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="changePasswordDialog.visible = false">å–æ¶ˆ</el-button>
                <el-button type="primary" @click="changePassword" :loading="changePasswordDialog.loading">
                    ç¡®å®š
                </el-button>
            </template>
        </el-dialog>

        <!-- åˆ›å»ºç®¡ç†å‘˜å¯¹è¯æ¡† -->
        <el-dialog v-model="createAdminDialog.visible" title="æ·»åŠ ç®¡ç†å‘˜" width="500px">
            <el-form :model="createAdminDialog.form" label-width="100px">
                <el-form-item label="ç”¨æˆ·å" required>
                    <el-input v-model="createAdminDialog.form.username" 
                            placeholder="è¯·è¾“å…¥ç”¨æˆ·å" />
                </el-form-item>
                <el-form-item label="å¯†ç " required>
                    <el-input v-model="createAdminDialog.form.password" 
                            type="password" 
                            placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"
                            show-password />
                </el-form-item>
                <el-form-item label="è§’è‰²">
                    <el-switch v-model="createAdminDialog.form.is_super_admin"
                             active-text="è¶…çº§ç®¡ç†å‘˜"
                             inactive-text="æ™®é€šç®¡ç†å‘˜" />
                </el-form-item>
                <el-form-item v-if="!createAdminDialog.form.is_super_admin" label="æƒé™">
                    <el-checkbox-group v-model="createAdminDialog.form.permissions">
                        <div v-for="(perms, module) in availablePermissions" :key="module" style="margin-bottom: 10px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">{{ getModuleLabel(module) }}</div>
                            <el-checkbox v-for="perm in perms" :key="perm.name" :label="perm.name">
                                {{ perm.description }}
                            </el-checkbox>
                        </div>
                    </el-checkbox-group>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="createAdminDialog.visible = false">å–æ¶ˆ</el-button>
                <el-button type="primary" @click="createAdmin" :loading="createAdminDialog.loading">
                    åˆ›å»º
                </el-button>
            </template>
        </el-dialog>

        <!-- ç¼–è¾‘ç®¡ç†å‘˜å¯¹è¯æ¡† -->
        <el-dialog v-model="editAdminDialog.visible" title="ç¼–è¾‘ç®¡ç†å‘˜" width="500px">
            <el-form :model="editAdminDialog.form" label-width="100px">
                <el-form-item label="ç”¨æˆ·å">
                    <el-input :value="editAdminDialog.admin?.username" disabled />
                </el-form-item>
                <el-form-item label="æ–°å¯†ç ">
                    <el-input v-model="editAdminDialog.form.password" 
                            type="password" 
                            placeholder="ç•™ç©ºåˆ™ä¸ä¿®æ”¹å¯†ç "
                            show-password />
                </el-form-item>
                <el-form-item label="çŠ¶æ€">
                    <el-switch v-model="editAdminDialog.form.is_active"
                             active-text="å¯ç”¨"
                             inactive-text="ç¦ç”¨" />
                </el-form-item>
                <el-form-item label="è§’è‰²">
                    <el-switch v-model="editAdminDialog.form.is_super_admin"
                             active-text="è¶…çº§ç®¡ç†å‘˜"
                             inactive-text="æ™®é€šç®¡ç†å‘˜" />
                </el-form-item>
                <el-form-item v-if="!editAdminDialog.form.is_super_admin" label="æƒé™">
                    <el-checkbox-group v-model="editAdminDialog.form.permissions">
                        <div v-for="(perms, module) in availablePermissions" :key="module" style="margin-bottom: 10px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">{{ getModuleLabel(module) }}</div>
                            <el-checkbox v-for="perm in perms" :key="perm.name" :label="perm.name">
                                {{ perm.description }}
                            </el-checkbox>
                        </div>
                    </el-checkbox-group>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="editAdminDialog.visible = false">å–æ¶ˆ</el-button>
                <el-button type="primary" @click="updateAdmin" :loading="editAdminDialog.loading">
                    ä¿å­˜
                </el-button>
            </template>
        </el-dialog>
    </div>

    <!-- å¤–éƒ¨è„šæœ¬æ–‡ä»¶ -->
    <script src="assets/js/vue.prod.js"></script>
    <script src="assets/js/element-plus.js"></script>
    <script src="assets/js/element-plus-icons.js"></script>
    <script src="assets/js/axios.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/components/navbar.js"></script>
    
    <!-- é¡µé¢è„šæœ¬ -->
    <script src="assets/js/admin-manage.js"></script>
</body>
</html>
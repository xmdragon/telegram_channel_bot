<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram消息审核系统 - 星际争霸风格</title>
    
    <!-- 外部样式文件 -->
    <link rel="stylesheet" href="assets/css/element-plus.css">
    <link rel="stylesheet" href="assets/css/starcraft.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components/index.css">
    
    <!-- 外部脚本文件 -->
    <script src="assets/js/vue.js"></script>
    <script src="assets/js/element-plus.js"></script>
    <script src="assets/js/axios.js"></script>
    <script src="assets/js/components/index.js"></script>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>🚀 TELEGRAM 消息审核系统</h1>
            <p>智能采集 · 高效审核 · 自动转发</p>
        </div>

        <!-- 导航栏 -->
        <div class="nav-bar">
            <div class="nav-links">
                <a href="/" class="nav-link active">🏠 主控制台</a>
                <a href="/config" class="nav-link">⚙️ 系统配置</a>
                <a href="/status" class="nav-link">📊 系统状态</a>
                <a href="/auth" class="nav-link">🔐 Telegram登录</a>
            </div>
            <div class="nav-links">
                <span style="color: #7fdbff; font-weight: 700;">系统状态: {{ systemStatus }}</span>
            </div>
        </div>

        <div class="stats-container">
            <!-- 统计面板 -->
            <el-row :gutter="20" class="stats-card">
                <el-col :span="4" v-for="(stat, key) in stats" :key="key">
                    <el-card>
                        <div class="stat-value">{{ stat.value }}</div>
                        <div class="stat-label">{{ stat.label }}</div>
                    </el-card>
                </el-col>
            </el-row>

            <!-- 工具栏 -->
            <div class="toolbar">
                <div>
                    <el-select v-model="filters.status" placeholder="状态筛选" clearable @change="loadMessages">
                        <el-option label="待审核" value="pending"></el-option>
                        <el-option label="已批准" value="approved"></el-option>
                        <el-option label="已拒绝" value="rejected"></el-option>
                        <el-option label="自动转发" value="auto_forwarded"></el-option>
                    </el-select>
                    
                    <el-select v-model="filters.is_ad" placeholder="广告筛选" clearable @change="loadMessages">
                        <el-option label="广告消息" :value="true"></el-option>
                        <el-option label="正常消息" :value="false"></el-option>
                    </el-select>
                    
                    <el-button @click="loadMessages" icon="Refresh">刷新数据</el-button>
                </div>
                
                <div>
                    <el-button 
                        type="success" 
                        @click="batchApprove" 
                        :disabled="selectedMessages.length === 0"
                        icon="Check">
                        批量批准 ({{ selectedMessages.length }})
                    </el-button>
                </div>
            </div>

            <!-- 消息列表 -->
            <div v-for="message in messages" :key="message.id" class="message-card" 
                 :class="[message.is_ad ? 'ad' : '', message.status]">
                <el-card>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <strong style="color: #00ff41;">{{ message.source_channel }}</strong>
                            <span style="color: #7fdbff; margin-left: 10px;">#{{ message.message_id }}</span>
                        </div>
                        <div>
                            <el-tag :type="getStatusType(message.status)" size="small">
                                {{ getStatusText(message.status) }}
                            </el-tag>
                            <el-tag v-if="message.is_ad" type="danger" size="small" style="margin-left: 5px;">
                                广告
                            </el-tag>
                        </div>
                    </div>
                    
                    <div class="content-preview">
                        {{ message.content || '无文本内容' }}
                    </div>
                    
                    <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="color: #7fdbff; font-size: 12px;">
                            {{ formatTime(message.created_at) }}
                        </div>
                        <div>
                            <el-button 
                                v-if="message.status === 'pending'"
                                type="success" 
                                size="small" 
                                @click="approveMessage(message.id)"
                                icon="Check">
                                批准
                            </el-button>
                            <el-button 
                                v-if="message.status === 'pending'"
                                type="danger" 
                                size="small" 
                                @click="rejectMessage(message.id)"
                                icon="Close">
                                拒绝
                            </el-button>
                            <el-checkbox 
                                v-model="selectedMessages" 
                                :label="message.id"
                                style="margin-left: 10px;">
                            </el-checkbox>
                        </div>
                    </div>
                </el-card>
            </div>
        </div>
        
        <!-- 状态消息 -->
        <div v-if="statusMessage" class="status-message" :class="statusType">
            {{ statusMessage }}
        </div>
        
        <!-- 加载遮罩 -->
        <div v-if="loading" class="loading-overlay">
            <div class="loading-content">
                <el-icon class="is-loading">
                    <Loading />
                </el-icon>
                <p style="margin-top: 15px; color: #00ff41;">{{ loadingMessage }}</p>
            </div>
        </div>
    </div>

    <script>
        // 使用外部组件
        createApp(MainApp).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
#!/usr/bin/env python3
"""
æµ‹è¯•æ¶ˆæ¯è¿‡æ»¤bug - éªŒè¯è®­ç»ƒæ ·æœ¬è¯¯åˆ æ­£æ–‡å†…å®¹çš„é—®é¢˜
"""

# æ¨¡æ‹Ÿæ¶ˆæ¯7842çš„å†…å®¹
original_content = """#å›½å†…èµ„è®¯**

é©¬äº‘ä¸ºäº†ä¿å‘½ï¼Œå·²ä¸Šäº¤å…¨éƒ¨ä¸ªäººè´¢äº§ç»™å›½å®¶**

æˆªæ­£2025å¹´8æœˆ10æ—¥**ï¼Œèš‚èšé›†å›¢å·²å®Œæˆ"è§£é™¤é©¬äº‘å…ˆç”Ÿæ§åˆ¶æƒ"ï¼Œ**é›†å›¢è¡¨ç¤ºæ˜¯åˆ›å§‹äººé©¬äº‘è‡ªæ„¿æ”¾å¼ƒçš„ã€‚

**é©¬äº‘æŠŠå…¨éƒ¨å®¶äº§ä¸Šäº¤å›½å®¶å ªç§°æ—¶ä»£æ¥·æ¨¡ ï¼Œ**åƒé©¬äº‘è¿™æ ·ä¸»åŠ¨æŠŠå…¨éƒ¨èº«å®¶ä¸Šäº¤å›½å®¶æ±‚é¥¶ä¸€æ¡ç‹—å‘½çš„ä¼ä¸šå®¶ï¼Œé©¬äº‘ä¸æ˜¯ç¬¬ä¸€ä¸ªï¼Œä¹Ÿä¸ä¼šæ˜¯æœ€åä¸€ä¸ªã€‚**ç¬¬ä¸€æ‰¹æŠŠå…¨éƒ¨èº«å®¶ä¸Šäº¤å›½å®¶ä¿å‘½çš„æ˜¯ç‹å¥æ—å’Œèµµæœ¬å±±**

ğŸ“£**  **è®¢é˜…ğŸ‘‘ğŸ‘‘ğŸ‘‘ğŸ‘‘ğŸ‘‘ğŸ‘‘**é¢‘é“  â†“
****ğŸ”—**** **t.me/+8rnBOqnrjxM3M2Y1
âœ…**æŠ•ç¨¿æ¾„æ¸…çˆ†æ–™**ï¼š** **@dny228"""

# æ¨¡æ‹Ÿè®­ç»ƒæ ·æœ¬ä¸­çš„å°¾éƒ¨æ–‡æœ¬
tail_sample = "ä¸Šäº¤å›½å®¶ä¿å‘½çš„æ˜¯ç‹å¥æ—å’Œèµµæœ¬å±±**\n\nğŸ“£**  **è®¢é˜…ğŸ‘‘ğŸ‘‘ğŸ‘‘ğŸ‘‘ğŸ‘‘ğŸ‘‘**é¢‘é“  â†“"

# æ¨¡æ‹Ÿ _apply_trained_tail_filters çš„é”™è¯¯é€»è¾‘
def buggy_filter(content, tail_text):
    """æ¨¡æ‹Ÿæœ‰bugçš„è¿‡æ»¤é€»è¾‘"""
    if tail_text in content:
        # æ‰¾åˆ°æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®
        match_start = content.rfind(tail_text)
        if match_start != -1:
            # é”™è¯¯åœ°åˆ é™¤ä»è¿™é‡Œå¼€å§‹çš„æ‰€æœ‰å†…å®¹
            filtered = content[:match_start].rstrip()
            return filtered
    return content

# æµ‹è¯•
print("åŸå§‹å†…å®¹é•¿åº¦:", len(original_content))
print("\nåŸå§‹å†…å®¹å‰100å­—ç¬¦:")
print(original_content[:100])
print("\nåŸå§‹å†…å®¹å100å­—ç¬¦:")
print(original_content[-100:])

filtered = buggy_filter(original_content, tail_sample)
print("\nè¿‡æ»¤åå†…å®¹é•¿åº¦:", len(filtered))
print("\nè¿‡æ»¤åå†…å®¹:")
print(filtered)

print("\nè¢«åˆ é™¤çš„å†…å®¹:")
print(original_content[len(filtered):])

print("\nç»“è®º:")
print(f"åˆ é™¤äº† {len(original_content) - len(filtered)} ä¸ªå­—ç¬¦")
print(f"åˆ é™¤äº† {(len(original_content) - len(filtered)) / len(original_content) * 100:.1f}% çš„å†…å®¹")

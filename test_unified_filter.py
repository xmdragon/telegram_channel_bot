#!/usr/bin/env python3
"""
æµ‹è¯•ç»Ÿä¸€è¿‡æ»¤å¼•æ“å¯¹èµŒåšå¹¿å‘Šçš„æ£€æµ‹æ•ˆæœ
"""
import asyncio
from app.services.unified_filter_engine import unified_filter_engine

async def test_filter():
    """æµ‹è¯•è¿‡æ»¤å¼•æ“"""
    
    # æµ‹è¯•æ ·æœ¬ï¼ˆç±»ä¼¼N9çš„èµŒåšå¹¿å‘Šï¼‰
    test_messages = [
        {
            "name": "å…¸å‹èµŒåšå¹¿å‘Š",
            "content": """âš¡âš¡âš¡âš¡âš¡âš¡âš¡âš¡
**é’±åŒ…WGè”åæ‹…ä¿1000ä¸‡Uã€ ****æŸæŸ.COM**** ã€‘æŸ¥ã€****æŸæŸ.TOP**** ã€‘
** âš¡**å…¬å¹³å…¬æ­£ï¼ŒçœŸå®å¯é ã€‚è¯šä¿¡é€æ˜çš„å¨±ä¹ä½“éªŒï¼Œæ‰€æœ‰æ´¾å‘é“¾ä¸Šå¯æŸ¥ï¼ï¼ï¼ï¼ï¼å…¨ç½‘æœ€å…¬å¼€å…¬æ­£**
**ã€éªŒèµ„ï¼š****@æŸæŸcom_kf****ã€‘**

âš¡âš¡âš¡âš¡âš¡âš¡**
** ****æ–°ä¼šå‘˜å¥½ç¤¼ **ğŸ˜€ [**æ³¨å†Œå°±é€28.8U**](https://example.com/?id=642888594&currency=USDT&type=2)**
**æ³¨ï¼šç»‘å®šæ±‡æ—ºå®åè´¦å·è”ç³»å®¢æœç”³è¯·
ğŸ é¦–å­˜100Uèµ é€28U
ğŸ äºŒå­˜/ä¸‰å­˜æœ€é«˜èµ é€8888U
**è€ç”¨æˆ·å¥½ç¤¼****ğŸ˜€**** **ç”µå­ç‹‚æ¬¢æ¯æ—¥å­˜æ¬¾èµ é€10%
**å¤©å¤©å­˜æ¬¾å¤©å¤©é€ï¼Œå­˜æ¬¾å®Œæˆè”ç³»åœ¨çº¿å®¢æœç”³è¯·ï¼Œ**"""
        },
        {
            "name": "é¦–å­˜ä¼˜æƒ å¹¿å‘Š",
            "content": """ğŸ”¥ğŸ”¥ğŸ”¥ çº¿ä¸Šå¨±ä¹åŸ ğŸ”¥ğŸ”¥ğŸ”¥
é¦–å­˜100é€50ï¼Œæœ€é«˜é€8888
Uå­˜Uæï¼Œæ— éœ€å®å
ä¸é™IPï¼Œå…¨çƒå¯ç©
å®¢æœï¼š@kefu_service"""
        },
        {
            "name": "å¤šé“¾æ¥èµŒåšå¹¿å‘Š",
            "content": """ğŸ’°ğŸ’°ğŸ’° æ—¥èµšåƒä¸‡ä¸æ˜¯æ¢¦
å®˜ç½‘1: https://site1.com
å®˜ç½‘2: https://site2.com  
å®˜ç½‘3: https://site3.com
å¤‡ç”¨: https://backup.com
USDTå……å€¼ï¼Œç§’åˆ°è´¦"""
        },
        {
            "name": "æ­£å¸¸æ¶ˆæ¯",
            "content": """ä»Šå¤©åˆ†äº«ä¸€ä¸ªæœ‰è¶£çš„æ–°é—»ï¼ŒæŸæŸå…¬å¸å‘å¸ƒäº†æ–°äº§å“ï¼Œ
è¿™ä¸ªäº§å“çš„ç‰¹ç‚¹æ˜¯æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼Œç”¨æˆ·ä½“éªŒå¾ˆå¥½ã€‚"""
        }
    ]
    
    print("=" * 60)
    print("æµ‹è¯•ç»Ÿä¸€è¿‡æ»¤å¼•æ“")
    print("=" * 60)
    
    for test in test_messages:
        print(f"\næµ‹è¯•: {test['name']}")
        print("-" * 40)
        
        # æµ‹è¯•å¹¿å‘Šæ£€æµ‹
        is_ad, filtered_content, reason = await unified_filter_engine.detect_advertisement(
            test['content'],
            channel_id="test_channel"
        )
        
        print(f"æ˜¯å¦å¹¿å‘Š: {is_ad}")
        print(f"è¿‡æ»¤åŸå› : {reason}")
        print(f"å†…å®¹é•¿åº¦: {len(test['content'])} -> {len(filtered_content)}")
        
        if is_ad and not filtered_content:
            print("âœ… é«˜é£é™©å¹¿å‘Šï¼Œå†…å®¹å·²æ¸…ç©º")
        elif is_ad:
            print("âš ï¸ æ£€æµ‹åˆ°å¹¿å‘Šå†…å®¹")
        else:
            print("â„¹ï¸ æ­£å¸¸æ¶ˆæ¯")

if __name__ == "__main__":
    asyncio.run(test_filter())
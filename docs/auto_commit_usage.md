# 自动Git提交工具使用说明

## 概述

项目现在包含两个自动提交工具，用于标准化提交流程并自动生成规范的提交信息：

1. **auto_commit.py** - Python智能分析工具
2. **commit.sh** - Shell快速提交脚本

## 使用方法

### 1. 智能自动分析模式

```bash
# 自动分析变更并生成提交信息
python3 auto_commit.py

# 自动分析但使用自定义描述
python3 auto_commit.py auto "优化页面加载性能"
```

**特点：**
- 自动检测变更类型（fix/feat/docs等）
- 智能分析修改的文件并生成详细说明
- 支持交互式编辑提交信息
- 非交互环境下自动确认

### 2. 快速提交模式

```bash
# 快速提交bug修复
./commit.sh fix "修复登录页面验证码显示问题"

# 快速提交新功能
./commit.sh feat "添加消息批量导出功能"

# 快速提交更新
./commit.sh update "优化数据库查询性能"
```

### 3. 交互式提交模式

```bash
# 启动交互式提交（会显示选项菜单）
./commit.sh
```

提供以下提交类型：
- 🐛 fix - Bug修复
- ✨ feat - 新功能
- 🔄 update - 更新/优化
- 📝 docs - 文档
- 🎨 style - 样式
- ♻️ refactor - 重构
- 🔧 chore - 其他

## 提交信息格式

生成的提交信息遵循以下格式：

```
🐛 fix: 修复页面加载失败问题

详细说明：
- 修复Vue编译器错误
- 添加权限检查降级方案
- 优化错误处理机制

🤖 自动提交 2025-08-14 10:00:00
```

## 特性

### 智能分析

- **文件分类**：自动识别前端、后端、配置、文档等文件类型
- **变更检测**：分析新增、修改、删除的文件
- **类型推断**：根据文件变更自动推断提交类型

### 错误处理

- **非交互环境**：自动处理输入异常，避免在CI/CD中失败
- **Git状态检查**：确保在正确的Git仓库中执行
- **提交验证**：检查是否有变更需要提交

### 安全特性

- **确认机制**：提交前显示详细信息并要求确认
- **选择性推送**：可选择是否推送到远程仓库
- **错误回滚**：提交失败时提供详细错误信息

## 工作流程建议

1. **开发完成后**：
   ```bash
   # 检查变更
   git status
   
   # 使用自动提交工具
   python3 auto_commit.py
   ```

2. **快速修复**：
   ```bash
   ./commit.sh fix "修复的具体问题描述"
   ```

3. **新功能开发**：
   ```bash
   ./commit.sh feat "新功能的简要描述"
   ```

## 配置

### 忽略文件

建议在 `.gitignore` 中添加：
```
# 数据库文件
data/postgres/
data/redis/

# 日志文件
logs/
*.log

# 临时文件
temp_media/
```

### 自定义

可以修改 `auto_commit.py` 中的以下配置：

- `type_emoji`: 提交类型的emoji映射
- `categories`: 文件分类规则
- 提交信息模板

## 示例

### 修复bug后的提交
```bash
$ ./commit.sh fix "修复用户登录验证失败问题"
📊 变更摘要：
 M app/services/auth.py
 M static/login.html
✨ 共 2 个文件变更

📝 提交信息：
🐛 fix: 修复用户登录验证失败问题
🤖 自动提交 2025-08-14 10:30:00

确认提交？ (y/n): y
✅ 提交成功！
```

### 自动分析变更
```bash
$ python3 auto_commit.py
📊 检测到 3 个文件变更
  frontend: 2 个文件
  backend: 1 个文件

📝 生成的提交信息：
✨ feat: 前端页面更新、后端逻辑优化

详细说明：
- 修改 static/index.html
- 修改 static/assets/js/main.js
- 修改 app/services/message_processor.py

🤖 由 auto_commit.py 自动生成
时间: 2025-08-14 10:35:00

是否使用此提交信息？ (y/n/e[编辑]): y
✅ 提交成功！
```

## 注意事项

1. **数据文件**：避免提交数据库文件和日志文件
2. **敏感信息**：确保不提交包含密码或密钥的文件
3. **文件大小**：避免提交过大的媒体文件
4. **提交频率**：建议在完成一个完整功能或修复后再提交

## 故障排除

### 常见问题

1. **"不是Git仓库"错误**
   - 确保在项目根目录执行命令
   - 检查是否已初始化Git仓库

2. **"没有变更"提示**
   - 使用 `git status` 检查是否有未跟踪的文件
   - 确认修改已保存

3. **推送失败**
   - 检查网络连接
   - 确认远程仓库权限
   - 可能需要先拉取远程更新

4. **非交互环境错误**
   - 工具已自动处理EOFError异常
   - 在CI/CD中会自动确认提交

通过这些工具，可以确保代码提交的规范性和一致性，提高开发效率。